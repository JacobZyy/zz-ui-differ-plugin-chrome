---
trigger: model_decision
description: 强制TypeScript严格模式和类型定义的最佳实践
globs: *ts,.tsx
---

# TypeScript 规则

## AI代码生成标识强制规范

- 所有由 AI 生成或修改的代码块，包括但不限于聊天、代码片段、代码示例、代码建议、推荐写法等等，都必须在代码前添加如下注释： // generated by ai
- 如果仅修改部分代码，需要在修改处加注释
- 如果是一个文件内多处生成代码块或多处修改代码，需要在每一处的前加注释。
- 连续的代码行，不要每行都加，在代码块前加注释，避免注释密度太大。
- 这条注释必须单独一行，不要和其他注释生成在一行内
- 该规则始终生效，适用于所有 AI 生成方式（chat、command+k、tab 补全、自动生成等），无论输出场景为何。

## 类型系统规范

### 类型定义优先级

- **接口 (interface)**: 对象结构定义、类实现、声明合并
- **类型别名 (type)**: 联合类型、交叉类型、映射类型、条件类型
- **枚举 (enum)**: 常量集合，优先使用 const enum

### 类型安全要求

- 禁止使用 `any`，使用 `unknown`、`object` 或具体类型
- 启用严格模式：`strict: true`
- 使用可选链 `?.` 和空值合并 `??`
- 类型断言优先使用 `as` 语法

### 泛型使用规范

- 使用有意义的泛型名称，避免单字母
- 为泛型添加约束，提高类型安全性
- 使用默认泛型参数简化调用

## 命名约定规范

### 接口和类型

- 接口使用 I 前缀 + PascalCase：`interface IUserService`
- 类型别名使用 PascalCase：`type UserStatus`
- 泛型参数使用有意义名称：`<TEntity, TKey>`

### 枚举和常量

- 枚举使用 PascalCase：`enum HttpStatus`
- 常量使用 UPPER_CASE：`const API_BASE_URL`

### 函数和变量

- 函数使用 camelCase，明确返回类型
- 异步函数明确返回 Promise 类型

## 最佳实践

### 类型守卫和工具类型

- 使用类型守卫确保类型安全：`function isString(value: unknown): value is string`
- 善用内置工具类型：`Omit`、`Pick`、`Partial`、`Required`
- 条件类型：`type ApiResponse<T> = T extends string ? { message: T } : { data: T }`
- 映射类型：`type Optional<T> = { [K in keyof T]?: T[K] }`

### 模块声明

- 为第三方库添加类型声明：`declare module 'library-name'`

## 性能优化

### 类型导入优化

- 使用 type-only 导入：`import type { IUser } from './types'`
- 按需导入类型

### 编译优化

- 使用 `skipLibCheck: true` 跳过库文件类型检查
- 启用 `incremental: true` 增量编译
- 合理配置 `include` 和 `exclude`

### 类型复用

- 提取公共类型到单独文件，定义基础实体接口和分页类型

## 团队协作规范

- 为复杂类型添加 JSDoc 注释，使用 `@example` 和 `@deprecated` 标签
- 使用 `@ts-expect-error` 而非 `@ts-ignore`，为向后兼容添加类型重载
- 代码审查：检查 `any` 类型泄露、异步函数错误处理、泛型约束合理性

## 使用建议

1. 遵循项目既定的代码风格
2. 保持代码的可读性和一致性
3. 在团队协作时注意遵循这些规则
